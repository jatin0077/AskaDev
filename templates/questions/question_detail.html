{% extends 'base.html' %}
{% load markdown_deux_tags %}
{% block body %}
<style>
    .like-btn, .like-btn:focus{
        background: transparent;
        border: none;
        outline: 0;
    }
	li{
		position: relative;
		margin-left: 20px;
	}
</style>
<div id="app_detail">
<div class="container">
    <h6 style="font-size: 28px;">{{ question.title }}<br/><span style="font-size: 20px;">
		Asked by 
		<vs-button href="/{{question.user}}" 
		size="small" line-origin="left" type="line"
		v-bind:style="{fontSize: '16px', fontWeight: '700'}"
		v-on:focus="function(e){e.style.outline='none'}">
			{{ question.user }}
		</vs-button>on 
        {{ question.asked_on }}</span>
    </h6>
    <div style="font-size: 24px;">
        {% if liked %} 
				<button v-on:click="likeQuestion" class="like-btn" id="addLike">
					<i class="fas fa-heart"  style="font-size: 1.5rem;color:var(--red); margin-top: -10px;"></i>
				</button>
				{% else %}
				<button v-on:click="likeQuestion" class="like-btn" id="addLike">
					<i class="far fa-heart" style="font-size: 1.5rem;color:var(--red);margin-top: -5px;"></i>
				</button>
				{% endif %}
        <span style="position:absolute;margin-left: 4px;">
            {% ifequal question.likes 1 %}
                <span id="likes_count">{{ question.likes }}</span><span> Like</span>
            {% else %}
                <span id="likes_count">{{ question.likes }}</span><span> Likes</span>
            {% endifequal %}
        </span>
    </div>
    <p style="margin-block-end: 0px;">
        {% for t in question.tags.all %}
             <div class="badge badge-pill badge-{{t.bg_color}}">{{t.tag}}</div>
         {% empty %}
         <div class="badge badge-pill badge-dark">No Tags</div>
        {% endfor %}
	 </p>
	 <vs-row vs-justify="center">
		<vs-col type="flex" vs-justify="center" vs-align="center" vs-w="12">
		  <vs-card>
			<div slot="header">
			  <h3>
				  Question
			  </h3>
			</div>
			<div>
				{% markdown %}
{{question.question|safe}}
				{% endmarkdown %}
			</div>
			<div slot="footer">
			  <vs-row vs-justify="flex-end">
				<vs-button href="/{{question.user}}" type="filled" color="danger" icon="person">Visit Profile</vs-button>
				&nbsp;
				<vs-button href="/answer/{{question.url}}/" type="filled" color="primary" icon="comment">Answer</vs-button>
			  </vs-row>
			</div>
		  </vs-card>
		</vs-col>
	  </vs-row>
    </div>
</div>
<div class="container">
    <br/>
    <h3>Answers</h3>
    {% for a in answers %}  
    <div class="card">
        <div class="card-body" style="padding: 0.75rem;">
            <p>{{a.answer|safe|linebreaks}}</p>
        </div>
        <div class="card-footer" style="padding: 0.75rem;">
            <span style="font-size: 14px;">
                Answered By <a href="/{{a.answered_by}}">{{ a.answered_by }}</a> on 
                {{ a.answered_at }}
            </span>
        </div>
    </div>
    <span>&nbsp;</span>
    {% empty %}
    <h4>Nobody has answered this question yet</h4>
    {% endfor %}
</div>
</div>
{% endblock %}
{% block script %}
<script>
	const app_detail = new Vue({
		el: '#app_detail',
		methods:{
		likeQuestion:  function(){
			document.querySelector('#addLike').disabled = true;
			axios.post('/like/', {
    			question: '{{question.url}}',
   				user: '{{request.user}}'
				  })
				.then((response) => {
					var liked = false
					var like_btn = document.querySelector(".far"); 
					if(like_btn === null){
						liked = true;
					}
					if(liked){
						let like_btn = document.querySelector(".fas");
						like_btn.classList.add("far");
						like_btn.classList.remove("fas");
						let likes_count = document.querySelector("#likes_count");
						likes_count.innerHTML = parseInt(likes_count.innerHTML)- 1; 
					}else{
						let like_btn = document.querySelector(".far");
						like_btn.classList.add("fas");
						like_btn.classList.remove("far");
						let likes_count = document.querySelector("#likes_count");
						likes_count.innerHTML = parseInt(likes_count.innerHTML) + 1
					}
				document.querySelector('#addLike').disabled = false;
				})
				.then((error) => {
					if(error !== undefined){
						console.log(error);
					}
				})
			}
		}
	})
</script>
{% endblock %}